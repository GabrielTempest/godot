[gd_scene load_steps=25 format=3 uid="uid://3eru6rtoplb3"]

[ext_resource type="Script" path="res://scripts/snail.gd" id="1_2iwks"]
[ext_resource type="Texture2D" uid="uid://kwlgi0iv2e16" path="res://assets/sprites/Rimururu idle.png" id="1_4pxyx"]
[ext_resource type="Texture2D" uid="uid://psy8xbcwuf3w" path="res://assets/sprites/Rimururu walking.png" id="1_p3ffj"]
[ext_resource type="Script" path="res://scripts/Damageable.gd" id="2_nrkjt"]
[ext_resource type="Texture2D" uid="uid://csw0ebq4u1qsc" path="res://assets/sprites/Rimururu dead scene.png" id="3_1diw6"]
[ext_resource type="Script" path="res://scripts/CharacterStateMachine.gd" id="5_qiwih"]
[ext_resource type="Script" path="res://scripts/State.gd" id="6_ts3ej"]
[ext_resource type="Script" path="res://scripts/HitState.gd" id="7_d8wvf"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_rxhty"]
size = Vector2(66, 105)

[sub_resource type="Animation" id="Animation_4j0k0"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}

[sub_resource type="Animation" id="Animation_eruc1"]
resource_name = "dead"
length = 0.3
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [ExtResource("3_1diw6")]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:hframes")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [3]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Sprite2D:frame")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 1,
"values": [0, 1, 2]
}

[sub_resource type="Animation" id="Animation_0aoss"]
resource_name = "idle"
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [ExtResource("1_4pxyx")]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:hframes")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [10]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Sprite2D:frame")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
}

[sub_resource type="Animation" id="Animation_whkux"]
resource_name = "walking"
length = 0.8
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [ExtResource("1_p3ffj")]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:hframes")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [8]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Sprite2D:frame")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5, 6, 7]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_mswk1"]
_data = {
"RESET": SubResource("Animation_4j0k0"),
"dead": SubResource("Animation_eruc1"),
"idle": SubResource("Animation_0aoss"),
"walking": SubResource("Animation_whkux")
}

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_doy6p"]
animation = &"dead"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_5wt7u"]
animation = &"idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_q8w6u"]
animation = &"walking"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_q02t4"]
animation = &"walking"

[sub_resource type="AnimationNodeBlendSpace1D" id="AnimationNodeBlendSpace1D_rly1d"]
blend_point_0/node = SubResource("AnimationNodeAnimation_5wt7u")
blend_point_0/pos = 0.0
blend_point_1/node = SubResource("AnimationNodeAnimation_q8w6u")
blend_point_1/pos = 1.0
blend_point_2/node = SubResource("AnimationNodeAnimation_q02t4")
blend_point_2/pos = -1.0

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_mkmlf"]
animation = &"walking"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_71rjp"]

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_xrnv6"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_ps4xy"]

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_uysqy"]
states/dead/node = SubResource("AnimationNodeAnimation_doy6p")
states/dead/position = Vector2(758, 100)
states/move/node = SubResource("AnimationNodeBlendSpace1D_rly1d")
states/move/position = Vector2(348, 100)
states/walking/node = SubResource("AnimationNodeAnimation_mkmlf")
states/walking/position = Vector2(517, 100)
transitions = ["walking", "dead", SubResource("AnimationNodeStateMachineTransition_71rjp"), "Start", "move", SubResource("AnimationNodeStateMachineTransition_xrnv6"), "move", "walking", SubResource("AnimationNodeStateMachineTransition_ps4xy")]
graph_offset = Vector2(-188, -39)

[node name="Snail" type="CharacterBody2D" node_paths=PackedStringArray("hit_state")]
collision_layer = 4
script = ExtResource("1_2iwks")
movement_speed = 100.0
hit_state = NodePath("CharacterStateMachine/Hit")

[node name="Sprite2D" type="Sprite2D" parent="."]
position = Vector2(-7.62939e-06, -1.19209e-07)
scale = Vector2(1.29902, 1.22319)
texture = ExtResource("1_4pxyx")
hframes = 10

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(0, -2)
shape = SubResource("RectangleShape2D_rxhty")

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
"": SubResource("AnimationLibrary_mswk1")
}

[node name="AnimationTree" type="AnimationTree" parent="."]
tree_root = SubResource("AnimationNodeStateMachine_uysqy")
anim_player = NodePath("../AnimationPlayer")
parameters/move/blend_position = 0

[node name="Damageable" type="Node" parent="."]
script = ExtResource("2_nrkjt")

[node name="CharacterStateMachine" type="Node" parent="." node_paths=PackedStringArray("character", "animation_tree", "current_state")]
script = ExtResource("5_qiwih")
character = NodePath("..")
animation_tree = NodePath("../AnimationTree")
current_state = NodePath("Walking")

[node name="Walking" type="Node" parent="CharacterStateMachine"]
script = ExtResource("6_ts3ej")

[node name="Dead" type="Node" parent="CharacterStateMachine"]
script = ExtResource("6_ts3ej")
can_move = false

[node name="Hit" type="Node" parent="CharacterStateMachine" node_paths=PackedStringArray("damageable", "dead_state", "return_state")]
script = ExtResource("7_d8wvf")
damageable = NodePath("../../Damageable")
dead_state = NodePath("../Dead")
return_state = NodePath("../Walking")
can_move = false

[node name="Timer" type="Timer" parent="CharacterStateMachine/Hit"]
wait_time = 0.25
one_shot = true

[node name="RayCast2D" type="RayCast2D" parent="."]
position = Vector2(49, -35)
target_position = Vector2(0, 107)
collision_mask = 3

[connection signal="animation_finished" from="AnimationTree" to="Damageable" method="_on_animation_tree_animation_finished"]
[connection signal="timeout" from="CharacterStateMachine/Hit/Timer" to="CharacterStateMachine/Hit" method="_on_timer_timeout"]
